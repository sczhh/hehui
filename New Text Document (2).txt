
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  name: hpa-name
  namespace: my-namespace
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment  # 基于Deployment进行扩缩
    name: deployment-name  # Deployment名
  minReplicas: 1   # 最大实例数
  maxReplicas: 10   # 最小实例数
  metrics:
  - type: Resource
    resource:
      name: cpu
      targetAverageUtilization: 50  # CPU阈值设定50%
  - type: Resource
    resource:
      name: memory
      targetAverageValue: 200Mi  # 内存设定200M
  - type: Pods
    pods:
      metricName: packets-per-second
      targetAverageValue: 1k   # 每秒数据量
  - type: Object
    object:
      metricName: requests-per-second
      target:
        apiVersion: extensions/v1beta1
        kind: Ingress
        name: main-route
      targetValue: 10k   # 每秒请求量
若需要指标生效，需要一定注明该pod的request cpu和memory，样例如下：

containers:
- image: nginx
  imagePullPolicy: Always
  name: default-mem-demo-ctr
  resources:
    requests:
      memory: 256Mi
      cpu: 2
计算逻辑 参考 https://github.com/kubernetes/community/blob/master/contributors/design-proposals/autoscaling/horizontal-pod-autoscaler.md#autoscaling-algorithm

TargetNumOfPods = ceil(sum(CurrentPodsCPUUtilization) / Target)
